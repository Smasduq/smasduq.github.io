<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Color Matcher - Smasduq</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Light-mode fallbacks when html is not .dark (pragmatic) */
        html:not(.dark) .bg-white { background-color: #ffffff !important; }
        html:not(.dark) .bg-gray-50 { background-color: #f9fafb !important; }
        html:not(.dark) .bg-gray-100 { background-color: #f3f4f6 !important; }
        html:not(.dark) .bg-indigo-50 { background-color: #eef2ff !important; }
        html:not(.dark) .bg-indigo-100 { background-color: #e0e7ff !important; }
        html:not(.dark) .bg-green-50 { background-color: #f0fdf4 !important; }
        html:not(.dark) .bg-green-100 { background-color: #dcfce7 !important; }
        html:not(.dark) .bg-red-100 { background-color: #fee2e2 !important; }
        html:not(.dark) .bg-yellow-100 { background-color: #fef3c7 !important; }
        html:not(.dark) .bg-purple-100 { background-color: #f3e8ff !important; }

        html:not(.dark) .text-gray-900 { color: #0f172a !important; }
        html:not(.dark) .text-gray-800 { color: #1f2937 !important; }
        html:not(.dark) .text-gray-700 { color: #374151 !important; }
        html:not(.dark) .text-gray-600 { color: #4b5563 !important; }
        html:not(.dark) .text-gray-500 { color: #6b7280 !important; }
        html:not(.dark) .text-gray-400 { color: #9ca3af !important; }

        /* Buttons/CTAs fallbacks */
        html:not(.dark) .dark\:bg-indigo-500, html:not(.dark) .bg-indigo-600 { background-color: #4f46e5 !important; }
        html:not(.dark) .dark\:bg-indigo-600, html:not(.dark) .bg-indigo-500 { background-color: #6366f1 !important; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 min-h-screen flex flex-col">

    <header class="bg-white dark:bg-gray-900 shadow-md">
        <nav class="container mx-auto px-6 py-4">
            <a href="games.html" class="text-lg text-indigo-600 hover:underline">&larr; Back to Game Zone</a>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-10 flex-grow">
        <div class="max-w-xl mx-auto text-center">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">The Color Matcher</h1>
            <p class="text-lg text-gray-600 mb-8">Click the button that matches the **COLOR OF THE TEXT** (the ink), not the word itself. Ready your reflexes!</p>
            
            <div id="game-area" class="bg-white dark:bg-gray-700 p-8 rounded-xl shadow-2xl">
                
                <div class="mb-8 p-4 border-b-2 border-gray-200">
                    <p id="instruction" class="text-2xl font-semibold text-indigo-600 mb-4">Click "Start" to begin!</p>
                    <div id="word-display" class="text-6xl font-extrabold" style="min-height: 80px;"></div>
                </div>
                
                <p id="message" class="text-xl font-medium text-red-500 mb-6">Fastest Time: -- ms</p>
                <div id="buttons" class="grid grid-cols-2 gap-4">
                    <button data-color="Red" class="game-button bg-red-500 text-white p-4 rounded-lg text-lg font-semibold hover:bg-red-600 transition duration-150">Red</button>
                    <button data-color="Blue" class="game-button bg-blue-500 text-white p-4 rounded-lg text-lg font-semibold hover:bg-blue-600 transition duration-150">Blue</button>
                    <button data-color="Green" class="game-button bg-green-500 text-white p-4 rounded-lg text-lg font-semibold hover:bg-green-600 transition duration-150">Green</button>
                    <button data-color="Yellow" class="game-button bg-yellow-500 text-gray-800 p-4 rounded-lg text-lg font-semibold hover:bg-yellow-600 transition duration-150">Yellow</button>
                </div>

                <button id="start-button" class="mt-8 w-full bg-indigo-500 text-white p-4 rounded-lg text-xl font-bold hover:bg-indigo-600 transition duration-200">START</button>
                
            </div>
            
            <div class="mt-12 p-6 bg-white dark:bg-gray-700 rounded-xl shadow-lg">
                <h3 class="text-2xl font-bold mb-4 text-gray-700 dark:text-white">Local High Scores</h3>
                <ol id="high-score-list" class="list-decimal list-inside text-left mx-auto max-w-xs text-gray-200 space-y-1">
                    </ol>
            </div>
        </div>
    </main>

    <script>
        // --- Game Setup ---
        const COLORS = ['Red', 'Blue', 'Green', 'Yellow'];
        const wordDisplay = document.getElementById('word-display');
        const message = document.getElementById('message');
        const startButton = document.getElementById('start-button');
        const buttons = document.querySelectorAll('.game-button');
        const scoreList = document.getElementById('high-score-list');

        let startTime;
        let targetColor;
        let isGameRunning = false;
        let scoreHistory = JSON.parse(localStorage.getItem('colorMatcherScores')) || [];

        // --- Utility Functions ---
        function getRandomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function renderDisplay() {
            const word = getRandomItem(COLORS);
            targetColor = getRandomItem(COLORS);

            // Ensure the word and the color are NOT the same (Stroop Effect)
            while (word === targetColor) {
                targetColor = getRandomItem(COLORS);
            }

            wordDisplay.textContent = word;
            wordDisplay.style.color = targetColor.toLowerCase();
            
            startTime = Date.now();
        }

        function handleStart() {
            isGameRunning = true;
            startButton.textContent = '...';
            startButton.disabled = true;
            message.textContent = 'Click the button matching the INK color!';
            
            // Re-enable buttons for the game
            buttons.forEach(button => button.disabled = false);

            renderDisplay();
        }

        function handleGuess(guessedColor) {
            if (!isGameRunning) return;

            const reactionTime = Date.now() - startTime;

            if (guessedColor === targetColor) {
                isGameRunning = false;
                message.textContent = `Correct! Reaction time: ${reactionTime} ms`;
                
                // Add score and update history
                scoreHistory.push(reactionTime);
                scoreHistory.sort((a, b) => a - b); // Sort ascending (faster times first)
                scoreHistory = scoreHistory.slice(0, 5); // Keep top 5
                localStorage.setItem('colorMatcherScores', JSON.stringify(scoreHistory));

                renderHighScores();

            } else {
                message.textContent = 'Wrong! Try again.';
            }

            startButton.textContent = 'Start New Game';
            startButton.disabled = false;
            wordDisplay.textContent = ' ';
            wordDisplay.style.color = 'black';
            
            // Disable buttons until new game starts
            buttons.forEach(button => button.disabled = true);
        }

        function renderHighScores() {
            scoreList.innerHTML = ''; // Clear existing scores
            if (scoreHistory.length === 0) {
                scoreList.innerHTML = '<li class="text-center">No scores yet. Play the game!</li>';
                return;
            }

            scoreHistory.forEach((score, index) => {
                const li = document.createElement('li');
                li.className = index === 0 ? 'font-bold text-indigo-500' : '';
                li.textContent = `${score} ms`;
                scoreList.appendChild(li);
            });

            // Update main message with best score
            message.textContent = `Fastest Time: ${scoreHistory[0]} ms`;
        }

        // --- Event Listeners and Initialization ---

        startButton.addEventListener('click', handleStart);

        buttons.forEach(button => {
            button.addEventListener('click', (e) => {
                const guessedColor = e.target.getAttribute('data-color');
                handleGuess(guessedColor);
            });
            button.disabled = true; // Disable buttons until start
        });

        // Initial setup
        renderHighScores();
    </script>
    <!-- Theme init: apply saved theme (no icons added) -->
    <script>
        (function(){
            try {
                const saved = localStorage.getItem('theme');
                if (saved === 'dark') document.documentElement.classList.add('dark');
                else if (saved === 'light') document.documentElement.classList.remove('dark');
                else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.classList.add('dark');
            } catch (e) { /* ignore */ }
        })();
    </script>
</body>
</html>